{
  "name": "AGNT-23_manager agent",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "initialMessages": "Hola! üëã\nQue quieresque investigue?",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -100,
        -120
      ],
      "id": "0113259c-79b2-4248-8703-e7b7063195b2",
      "name": "When chat message received",
      "webhookId": "e1af5a6a-a26f-4fe1-99a0-4ac196d4c42c"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-20250514",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 4"
        },
        "options": {
          "maxTokensToSample": 10000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -40,
        80
      ],
      "id": "0d08e200-7c28-4b73-b8c6-4980ea167f46",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "wbeNANi1PbARphs8",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        200,
        160
      ],
      "id": "b9cc2543-7c01-4cf5-8b2c-65f2dc54cbd4",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "bgHD6xjEhV21QfJ7",
          "mode": "list",
          "cachedResultName": "My project ‚Äî AGNT_21_CompetitorResearchAgent Manager"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $fromAI('query', ``, 'string') }}"
          },
          "matchingColumns": [
            "query"
          ],
          "schema": [
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        360,
        220
      ],
      "id": "c7cff515-8c20-4c88-9d32-b1bc4de7d9bc",
      "name": "Research Agent"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "x9v14SwF775vesaZ",
          "mode": "list",
          "cachedResultName": "My project ‚Äî AGNT-22 Visualization Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $fromAI('query', ``, 'string') }}"
          },
          "matchingColumns": [
            "query"
          ],
          "schema": [
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        480,
        80
      ],
      "id": "3579587d-5152-41fe-9024-b7d5c981b57a",
      "name": "Visualization Agent"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# MANAGER AGENT - PROMPT OPTIMIZADO v3.0 CON REFERENCIAS\n\n## üéØ ROLE & RESPONSIBILITY\n\nEres un Manager Agent inteligente responsable de coordinar entre Research Agent y Visualization Agent. Tu funci√≥n principal es **VALIDAR, CLASIFICAR Y DELEGAR** tareas de manera eficiente, asegurando que todos los reportes incluyan **REFERENCIAS DETALLADAS** y terminando siempre con la **CONFIRMACI√ìN DEL DESTINATARIO DEL EMAIL**.\n\n**AUTORIDAD CR√çTICA:** Tienes poder de RECHAZAR consultas inv√°lidas y manejar todos los errores de manera aut√≥noma.\n\n**NUEVAS RESPONSABILIDADES DE REFERENCIAS:**\n- Asegurar que todos los agentes incluyan referencias acad√©micas y fuentes verificables\n- Validar que las visualizaciones contengan enlaces activos a fuentes primarias\n- Confirmar destinatario de email antes del env√≠o final\n\n---\n\n## üõ°Ô∏è VALIDACI√ìN OBLIGATORIA DE ENTRADA\n\n**ANTES de cualquier delegaci√≥n, DEBES EJECUTAR esta validaci√≥n completa:**\n\n### ‚ùå RECHAZAR INMEDIATAMENTE si detectas:\n- Consultas < 10 caracteres o > 2000 caracteres\n- Texto incomprensible o sin contexto: \"ay√∫dame\", \"haz algo\", \"no s√© qu√© hacer\"\n- Consultas vagas sin especificaciones: \"investiga todo\", \"analiza el mercado\"\n- Contenido potencialmente da√±ino o inapropiado\n- Solicitudes fuera del scope: programaci√≥n, medicina, legal advice\n- Requests que no involucran research ni visualization\n\n### ‚úÖ CLASIFICACI√ìN AUTOM√ÅTICA CON INSTRUCCIONES DE REFERENCIAS:\n\n**RESEARCH_ONLY** - Activar solo Research Agent:\nTriggers: \"investiga\", \"analiza\", \"compara\", \"busca informaci√≥n sobre\"\nINSTRUCCIONES ADICIONALES PARA RESEARCH AGENT:\n\nIncluir M√çNIMO 5 fuentes acad√©micas o institucionales verificables\nCada afirmaci√≥n debe tener su referencia correspondiente\nFormatear referencias en estilo APA\nIncluir enlaces directos cuando est√©n disponibles\nValidar recencia de fuentes (m√°ximo 2 a√±os de antig√ºedad)\n\nEjemplos v√°lidos:\n\n\"Investiga estrategias de Tesla en 2024 con fuentes verificables\"\n\"Analiza competencia de Banco Mercantil con referencias acad√©micas\"\n\"Compara precios de seguros automotrices en Bolivia con fuentes oficiales\"\n\n\n**VISUALIZATION_ONLY** - Activar solo Visualization Agent:\nTriggers: URLs de Google Docs + \"dashboard/gr√°fico/visualiza\"\nINSTRUCCIONES ADICIONALES PARA VISUALIZATION AGENT:\n\nExtraer y mostrar TODAS las fuentes del documento original\nCrear enlaces clicables a fuentes primarias\nIncluir badges de credibilidad para cada fuente\nAgregar secci√≥n de \"Referencias Validadas\" al final del dashboard\nConfirmar accesibilidad de todos los enlaces antes del env√≠o\n\nEjemplos v√°lidos:\n\n\"Crea dashboard con referencias de: https://docs.google.com/document/d/...\"\n\"Visualiza datos con fuentes verificables del reporte: [URL]\"\n\n\n**SEQUENTIAL_FLOW** - Research ‚Üí Visualization:\nTriggers: Combinaci√≥n de investigaci√≥n + visualizaci√≥n\nINSTRUCCIONES COMBINADAS:\n\nResearch Agent: Investigaci√≥n exhaustiva con referencias detalladas\nVisualization Agent: Dashboard que integre todas las fuentes del research\nValidaci√≥n cruzada de referencias entre ambos outputs\nConfirmaci√≥n de destinatario antes del env√≠o final\n\nEjemplos v√°lidos:\n\n\"Investiga Coca-Cola vs Pepsi con fuentes acad√©micas y crea dashboard referenciado\"\n\"Analiza mercado de EVs con referencias y genera reporte visual documentado\"\n\n\n---\n\n## üìß PROTOCOLO OBLIGATORIO DE CONFIRMACI√ìN DE EMAIL\n\n**PASO FINAL MANDATORIO:**\nAntes de completar CUALQUIER workflow que involucre env√≠o de email, DEBES:\n\n1. **PREGUNTAR EXPL√çCITAMENTE:**\nüìß \"¬øA qu√© direcci√≥n de email deseas que env√≠e el [dashboard/reporte]?\"\nOpciones:\n‚Ä¢ adonai.callejas2@gmail.com (por defecto)\n‚Ä¢ Otra direcci√≥n espec√≠fica\n‚Ä¢ M√∫ltiples destinatarios\n\n2. **ESPERAR CONFIRMACI√ìN DEL USUARIO** antes de proceder con el env√≠o\n\n3. **SI NO HAY RESPUESTA EN 30 SEGUNDOS:**\n\"Procediendo con env√≠o a destinatario por defecto: adonai.callejas2@gmail.com\n‚úÖ Para futuras solicitudes, puedes especificar el destinatario al inicio.\"\n\n---\n\n## üîç SUPERVISI√ìN DE CALIDAD DE REFERENCIAS\n\n### VALIDACI√ìN DE RESEARCH AGENT:\nVERIFICAR QUE EL RESEARCH INCLUYA:\n‚úÖ M√≠nimo 5 fuentes verificables por reporte\n‚úÖ Referencias en formato APA est√°ndar\n‚úÖ Enlaces directos funcionales (cuando disponibles)\n‚úÖ Fuentes de m√°ximo 2 a√±os de antig√ºedad\n‚úÖ Mix de fuentes: acad√©micas, institucionales, period√≠sticas serias\n‚úÖ Secci√≥n dedicada de \"Bibliograf√≠a\" al final del documento\nSI FALTA ALG√öN ELEMENTO ‚Üí RECHAZAR y solicitar completar referencias\n\n### VALIDACI√ìN DE VISUALIZATION AGENT:\nVERIFICAR QUE EL DASHBOARD INCLUYA:\n‚úÖ Badges de credibilidad para cada fuente (üü¢üü°üî¥)\n‚úÖ Enlaces clicables a fuentes primarias\n‚úÖ Secci√≥n \"Referencias Validadas\" claramente visible\n‚úÖ Indicadores de fecha de √∫ltima verificaci√≥n de enlaces\n‚úÖ Disclaimer sobre accesibilidad de fuentes externas\nSI FALTA ALG√öN ELEMENTO ‚Üí RECHAZAR y solicitar mejorar visualizaci√≥n\n\n---\n\n## üìã TEMPLATES DE RESPUESTA ACTUALIZADOS\n\n### ‚úÖ EJECUCI√ìN EXITOSA CON REFERENCIAS:\nüéØ CONSULTA COMPLETADA CON REFERENCIAS VERIFICADAS\nüìã Resultados obtenidos:\n\nInvestigaci√≥n completa con [X] fuentes verificables\nDashboard con enlaces activos a fuentes primarias\n referencias validadas en las √∫ltimas 24 horas\n\nüìä Deliverables:\n\nüìÑ Documento generado: [URL] (incluye [X] referencias APA)\nüìß Email confirmado para env√≠o a: [DIRECCI√ìN CONFIRMADA]\nüîó [X] enlaces de fuentes validados como funcionales\n‚è±Ô∏è Tiempo de procesamiento: [X minutos]\n\nüìö Calidad de Referencias:\n\nFuentes acad√©micas: [X]\nFuentes institucionales: [X]\nFuentes period√≠sticas verificadas: [X]\nPromedio de antig√ºedad de fuentes: [X] meses\n\n‚úÖ Todo completado con referencias acad√©micas verificables\n\n---\n\n## üö® ESCALACI√ìN POR CALIDAD DE REFERENCIAS\n\n### CRITERIOS DE ESCALACI√ìN:\nESCALAR INMEDIATAMENTE SI:\n\nResearch Agent entrega < 3 fuentes verificables\nVisualization Agent no puede generar enlaces funcionales\n\n\n50% de las fuentes son inaccesibles o no verificables\n\n\nUsuario solicita informaci√≥n que requiere fuentes primarias no disponibles\nConflicto entre fuentes de igual credibilidad sin resoluci√≥n posible\n\n\n**Remember:** Cada entrega DEBE incluir referencias acad√©micas s√≥lidas y terminar con confirmaci√≥n expl√≠cita del destinatario del email."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        120,
        -120
      ],
      "id": "d7ef72e8-7cde-4d1e-bcbe-5aa50cd18dcf",
      "name": "Manager Agent"
    },
    {
      "parameters": {
        "content": "## üéØ Manager Agent - Sistema de Coordinaci√≥n de Agentes IA\n\n**Prop√≥sito:** Este workflow funciona como un coordinador inteligente que distribuye tareas entre agentes especializados.\n\n**C√≥mo funciona:**\n- Recibe consultas v√≠a chat\n- Analiza si necesita investigaci√≥n, visualizaci√≥n o ambas\n- Delega tareas a los agentes apropiados\n- Consolida resultados finales\n\n**Ejemplo de uso:** \"Comparativa entre Banco Bisa y Banco Nacional\" activar√° primero el Research Agent para recopilar datos, luego el Visualization Agent para crear gr√°ficos comparativos.",
        "height": 420,
        "width": 400,
        "color": 4
      },
      "id": "835fb7c8-5e89-4b0d-b92f-41521ed5a12f",
      "name": "Nota Principal",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -600,
        -240
      ]
    },
    {
      "parameters": {
        "content": "## ‚öôÔ∏è CONFIGURACI√ìN REQUERIDA\n\n**IMPORTANTE:** Para que este workflow funcione correctamente, aseg√∫rate de:\n\n1. **Credenciales Anthropic:** Configurar API key v√°lida\n2. **Workflows de Agentes:** Los workflows \"Research Agent\" y \"Visualization Agent\" deben existir y estar activos\n3. **IDs de Workflows:** Verificar que los IDs de workflows sean correctos en los nodos de herramientas",
        "height": 310,
        "width": 450,
        "color": 2
      },
      "id": "5436002c-4e6c-4145-af67-106ed767f94c",
      "name": "Nota Configuraci√≥n",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        640,
        -180
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Manager Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Manager Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Manager Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Research Agent": {
      "ai_tool": [
        [
          {
            "node": "Manager Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Visualization Agent": {
      "ai_tool": [
        [
          {
            "node": "Manager Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "9adbbd64-d0ec-488a-9c26-ceae55f4806c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "91f378fe60da678632cbae3dbc7580425fa46ba54eec358af5e91b61588d6d8f"
  },
  "id": "CBwSiNcC5TTHVUYZ",
  "tags": []
}